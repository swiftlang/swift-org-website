# Site Check Report Format

This document describes the JSON format of the report generated by `site-check.js`. The report provides comprehensive information about website structure, link integrity, and content issues.

## Overview

The report is generated by crawling a website (typically a local development instance) and analyzing:

- Page structure and link topology
- Internal and external links
- Image resources
- Content issues (broken links, errors, redirects)
- Page isolation and connectivity

## Top-Level Structure

```json
{
  "timestamp": "2025-11-11T00:40:59.540Z",
  "config": {
    /* Configuration object */
  },
  "summary": {
    /* Summary statistics */
  },
  "pages": {
    /* Page-by-page details */
  }
}
```

### Fields

| Field       | Type   | Description                                      |
| ----------- | ------ | ------------------------------------------------ |
| `timestamp` | string | ISO 8601 timestamp when the report was generated |
| `config`    | object | Configuration settings used for the crawl        |
| `summary`   | object | High-level statistics about the crawl results    |
| `pages`     | object | Detailed information for each discovered page    |

## Configuration Object

Records the settings used during the crawl.

```json
{
  "baseUrl": "http://localhost:4000",
  "maxPages": 1000,
  "timeout": 30000,
  "checkExternalLinks": false,
  "concurrency": 3,
  "outputFile": "site-check-report.json",
  "delayBetweenRequests": 50
}
```

### Fields

| Field                  | Type    | Description                                              |
| ---------------------- | ------- | -------------------------------------------------------- |
| `baseUrl`              | string  | Base URL that was crawled                                |
| `maxPages`             | number  | Maximum number of pages to crawl (hard limit)            |
| `timeout`              | number  | Page load timeout in milliseconds                        |
| `checkExternalLinks`   | boolean | Whether external links were validated (currently unused) |
| `concurrency`          | number  | Planned concurrent crawl workers (currently unused)      |
| `outputFile`           | string  | Path where the report was saved                          |
| `delayBetweenRequests` | number  | Delay in milliseconds between page requests              |

## Summary Object

Provides aggregate statistics across the entire crawl.

```json
{
  "totalPages": 441,
  "totalLinks": 15070,
  "brokenLinks": 0,
  "brokenImages": 0,
  "redirects": 0,
  "isolatedPages": 116,
  "errors": 19,
  "externalDomains": 216
}
```

### Fields

| Field             | Type   | Description                                                                |
| ----------------- | ------ | -------------------------------------------------------------------------- |
| `totalPages`      | number | Number of pages successfully visited                                       |
| `totalLinks`      | number | Total count of internal links across all pages (header + footer + content) |
| `brokenLinks`     | number | Count of internal links that returned 404 or failed validation             |
| `brokenImages`    | number | Count of unique broken images found                                        |
| `redirects`       | number | Count of pages that redirect (excludes trailing slash redirects)           |
| `isolatedPages`   | number | Count of pages with no incoming links (orphaned pages)                     |
| `errors`          | number | Count of pages that failed to load or threw errors                         |
| `externalDomains` | number | Count of unique external domains linked from the site                      |

## Pages Object

A map of page URIs to detailed page information. Each key is a URI (e.g., `/`, `/blog/post`, `/documentation`).

### URI Format

- **Internal pages**: Stored as URIs (path + search + hash)
  - Homepage: `/`
  - Regular pages: `/blog/post`, `/documentation/guide`
  - With query params: `/search?q=swift`
  - With hash: `/docs/api#section`
- **External links**: Stored as full URLs in the `externalLinks` array
  - Example: `https://github.com/apple/swift`

### Page Object Structure

```json
"/": {
  "incomingLinks": ["/about", "/blog", "/documentation"],
  "isIsolated": false,
  "outgoingLinks": {
    "header": ["/documentation", "/community"],
    "footer": ["/", "/legal/license.html"],
    "content": ["/get-started/cloud-services"]
  },
  "externalLinks": [
    "https://github.com/swiftlang/sourcekit-lsp",
    "https://developer.apple.com/xcode"
  ],
  "imagesCount": 12,
  "issues": {
    "redirect": null,
    "error": null,
    "brokenLinks": [],
    "brokenImages": []
  }
}
```

### Page Fields

| Field           | Type          | Description                                                        |
| --------------- | ------------- | ------------------------------------------------------------------ |
| `incomingLinks` | array[string] | List of URIs that link to this page (deduplicated)                 |
| `isIsolated`    | boolean       | `true` if page has no incoming links (orphaned), `false` otherwise |
| `outgoingLinks` | object        | Categorized outgoing internal links (see below)                    |
| `externalLinks` | array[string] | Full URLs to external domains (deduplicated)                       |
| `imagesCount`   | number        | Total number of images on this page                                |
| `issues`        | object        | Content and structural issues (see below)                          |

### Outgoing Links Object

Links are categorized by their location in the page structure:

```json
{
  "header": ["/", "/documentation", "/community"],
  "footer": ["/legal/license.html", "/privacy"],
  "content": ["/blog/post", "/getting-started"]
}
```

| Field     | Type          | Description                                                   |
| --------- | ------------- | ------------------------------------------------------------- |
| `header`  | array[string] | URIs of links found in `<header class="site-navigation">`     |
| `footer`  | array[string] | URIs of links found in `<footer class="global-footer">`       |
| `content` | array[string] | URIs of links found elsewhere (all links minus header/footer) |

**Note**: Links are stored as URIs for internal links only. External links are in the `externalLinks` array.

### Issues Object

Describes problems found on this page:

```json
{
  "redirect": {
    "to": "/new-location",
    "status": 301
  },
  "error": "HTTP 404",
  "brokenLinks": [
    {
      "url": "/missing-page",
      "status": 404
    }
  ],
  "brokenImages": [
    {
      "url": "/images/missing.png",
      "alt": "Logo image"
    }
  ]
}
```

#### Issue Fields

| Field          | Type           | Description                                                                |
| -------------- | -------------- | -------------------------------------------------------------------------- |
| `redirect`     | object \| null | If page redirects, contains `to` (URI) and `status` (HTTP code)            |
| `error`        | string \| null | Error message if page failed to load (e.g., "HTTP 404", exception message) |
| `brokenLinks`  | array[object]  | Links from this page that are broken (see below)                           |
| `brokenImages` | array[object]  | Images on this page that failed to load (see below)                        |

#### Broken Link Object

```json
{
  "url": "/missing-page",
  "status": 404
}
```

| Field    | Type   | Description                      |
| -------- | ------ | -------------------------------- |
| `url`    | string | URI of the broken link           |
| `status` | number | HTTP status code (typically 404) |

#### Broken Image Object

```json
{
  "url": "/images/missing.png",
  "alt": "Logo image"
}
```

| Field | Type   | Description                                                  |
| ----- | ------ | ------------------------------------------------------------ |
| `url` | string | URI of the broken image                                      |
| `alt` | string | Alt text from the `<img>` tag, or "(no alt text)" if missing |

## Usage Patterns for AI Agents

### Finding Broken Links

```javascript
// Get all pages with broken links
const pagesWithBrokenLinks = Object.entries(report.pages)
  .filter(([uri, page]) => page.issues.brokenLinks.length > 0)
  .map(([uri, page]) => ({
    pageUri: uri,
    brokenLinks: page.issues.brokenLinks,
  }))
```

### Finding Isolated Pages

```javascript
// Get all isolated (orphaned) pages
const isolatedPages = Object.entries(report.pages)
  .filter(([uri, page]) => page.isIsolated && uri !== '/')
  .map(([uri, page]) => ({
    uri,
    outgoingLinkCount:
      page.outgoingLinks.header.length +
      page.outgoingLinks.footer.length +
      page.outgoingLinks.content.length,
  }))
```

### Finding Most Linked Pages

```javascript
// Find pages with most incoming links (most popular)
const mostLinked = Object.entries(report.pages)
  .map(([uri, page]) => ({
    uri,
    incomingCount: page.incomingLinks.length,
  }))
  .sort((a, b) => b.incomingCount - a.incomingCount)
  .slice(0, 10)
```

### Finding Pages with Errors

```javascript
// Get all pages that failed to load
const errorPages = Object.entries(report.pages)
  .filter(([uri, page]) => page.issues.error !== null)
  .map(([uri, page]) => ({
    uri,
    error: page.issues.error,
    referrers: page.incomingLinks,
  }))
```

### Analyzing External Dependencies

```javascript
// Count external links per page
const externalLinkAnalysis = Object.entries(report.pages)
  .filter(([uri, page]) => page.externalLinks.length > 0)
  .map(([uri, page]) => ({
    uri,
    externalCount: page.externalLinks.length,
    domains: [
      ...new Set(page.externalLinks.map((url) => new URL(url).hostname)),
    ],
  }))
```

### Finding Dead Ends (Pages with No Outgoing Links)

```javascript
// Find pages that don't link to anything
const deadEnds = Object.entries(report.pages)
  .filter(([uri, page]) => {
    const totalOutgoing =
      page.outgoingLinks.header.length +
      page.outgoingLinks.footer.length +
      page.outgoingLinks.content.length
    return totalOutgoing === 0
  })
  .map(([uri]) => uri)
```

### Tracing Link Paths

```javascript
// Find all pages that link to a specific page
function findReferrers(targetUri) {
  const page = report.pages[targetUri]
  return page ? page.incomingLinks : []
}

// Find all pages linked from a specific page
function findLinksFrom(sourceUri) {
  const page = report.pages[sourceUri]
  if (!page) return []

  return [
    ...page.outgoingLinks.header,
    ...page.outgoingLinks.footer,
    ...page.outgoingLinks.content,
  ]
}
```

### Content Link Analysis

```javascript
// Find pages that only have navigation links (no content links)
const noContentLinks = Object.entries(report.pages)
  .filter(([uri, page]) => page.outgoingLinks.content.length === 0)
  .map(([uri, page]) => ({
    uri,
    hasHeaderLinks: page.outgoingLinks.header.length > 0,
    hasFooterLinks: page.outgoingLinks.footer.length > 0,
  }))
```

## Important Notes for AI Agents

1. **URI vs URL**:

   - Internal links are always stored as URIs (e.g., `/blog/post`)
   - External links are always full URLs (e.g., `https://github.com/apple/swift`)
   - This distinction is critical when processing links

2. **Homepage Representation**:

   - The homepage is always represented as `/`
   - Never as empty string or full base URL

3. **Link Deduplication**:

   - `incomingLinks` and `externalLinks` arrays are deduplicated
   - Outgoing links may contain duplicates (intentionally preserved to show frequency)

4. **Isolated Page Detection**:

   - Pages with `isIsolated: true` have no incoming links
   - Homepage (`/`) is excluded from isolation analysis
   - Self-referencing links are filtered out when checking isolation

5. **Error Pages**:

   - Pages with `issues.error` failed to load during crawl
   - These pages may still be referenced by other pages (check `incomingLinks`)

6. **Redirects**:

   - Only non-trivial redirects are tracked
   - Trailing slash redirects (`/page` â†’ `/page/`) are ignored

7. **Link Categories**:

   - Header links: From `<header class="site-navigation">`
   - Footer links: From `<footer class="global-footer">`
   - Content links: All other links (defensive catch-all)
   - Categories may overlap if HTML structure is ambiguous

8. **Broken Images**:

   - Tracked by monitoring failed resource requests in browser
   - Same broken image may appear on multiple pages
   - Check the `alt` field to understand image purpose

9. **External Domain Count**:

   - `summary.externalDomains` counts unique hostnames
   - Use this to understand external dependencies
   - Individual external URLs are in each page's `externalLinks` array

10. **Crawl Limits**:
    - `config.maxPages` defines hard limit on pages visited
    - If `summary.totalPages` equals `config.maxPages`, crawl may be incomplete
    - Some pages may be discovered but not visited (will appear in other pages' `outgoingLinks`)
